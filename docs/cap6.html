<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="pt_BR">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Capítulo 6: Perca o medo do servidor Apache e do protocolo CGI &#8212; documentação Aprenda a Programar 04</title>
    
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '04',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="index" title="Índice" href="genindex.html" />
    <link rel="search" title="Buscar" href="search.html" />
    <link rel="prev" title="Capítulo 5: O segredo dos objetos-função" href="cap5.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="capitulo-6-perca-o-medo-do-servidor-apache-e-do-protocolo-cgi">
<h1>Capítulo 6: Perca o medo do servidor Apache e do protocolo CGI<a class="headerlink" href="#capitulo-6-perca-o-medo-do-servidor-apache-e-do-protocolo-cgi" title="Link permanente para este título">¶</a></h1>
<p>É hora de colocar em prática os nossos conhecimentos de funções e módulos para criar nosso primeiro programa para a Internet: o Calendário Dinâmico. Uma vez instalado em um servidor web, ele exibirá o calendário do mês atual com o dia de hoje assinalado. Ao final desse capítulo você terá construído seus primeiros programas CGI em linguagem Python. Mas para chegar lá, é preciso entender o funcionamento de um CGI, e conhecer como se dá a operação básica de um servidor HTTP.
Quem é quem do HTTP</p>
<p>A Web é construída a partir de duas tecnologias fundamentais: a linguagem HTML e o protocolo HTTP. HTML, ou Hypertext Markup Language é a codificação usada para criar as páginas da Web. Este não é o assunto deste curso, mas vamos usar um pouco de HTML nos exemplos desse capítulo.</p>
<p>O segundo pilar da Web é o HTTP, ou Hypertext Transport Protocol - protocolo de transporte de hipertexto. Esse é o conjunto de comandos e regras que define como deve ser a comunicação entre um browser (como o Internet Explorer ou o Mozilla) e um servidor HTTP (como o Apache ou o Interner Information Server). A expressão &#8220;servidor HTTP&#8221; pode significar duas coisas: o software que serve páginas via HTTP, ou o computador onde esse software está instalado. No mundo Unix, softwares servidores são chamados de &#8220;daemons&#8221;, e a sigla HTTPd descreve um &#8220;HTTP daemon&#8221; genérico. Essa é a sigla que vamos usar para diferenciar o software do hardware.</p>
<img alt="_images/img_06_01.png" src="_images/img_06_01.png" />
<p>A relação entre um browser e um HTTPd é descrita pelos computólogos como &#8220;cliente-servidor&#8221;. Isso significa que a interação entre esses dois softwares sempre parte do browser, que é o cliente. O servidor não tem nenhuma iniciativa, limitando-se a responder aos comandos enviados pelo cliente.</p>
<p>Quando você digita uma URL como <a class="reference external" href="https://codigo42.github.io/aprendaprog/">https://codigo42.github.io/aprendaprog/</a>, o seu browser localiza e conecta-se ao servidor <code class="docutils literal"><span class="pre">codigo42.github.io</span></code> e envia-lhe o comando <code class="docutils literal"><span class="pre">GET</span> <span class="pre">/aprendaprog/</span></code>. O servidor então lê o arquivo <code class="docutils literal"><span class="pre">index.html</span></code> da pasta <code class="docutils literal"><span class="pre">aprendaprog</span></code>, transmite seu conteúdo para o cliente e encerra a conexão. Esses são os passos básicos de qualquer interação de um browser com um HTTPd: conexão, solicitação, resposta e desconexão.</p>
<div class="section" id="paginas-dinamicas">
<h2>Páginas dinâmicas<a class="headerlink" href="#paginas-dinamicas" title="Link permanente para este título">¶</a></h2>
<p>No exemplo que acabamos de ver, <code class="docutils literal"><span class="pre">index.html</span></code> é o que chamamos de uma página estática. A resposta do servidor consiste apenas em enviar uma cópia do documento para o cliente. Sites que incluem transações (como lojas virtuais), interatividade (como chats), ou atualizações muito freqüentes (como este) utilizam páginas dinâmicas. Neste caso, ao receber a URL <a class="reference external" href="http://www.magnet.com.br/">http://www.magnet.com.br/</a> index_html, nosso servidor HTTPd Apache passa a solicitação para o aplicativo Zope, instalado no servidor. O Zope monta imediatamente a página <code class="docutils literal"><span class="pre">index_html</span></code> listando as notícias mais recentes de nosso banco de dados, a hora atual e outros elementos. A página recém montada então é passada para o Apache, que finalmente a transmite para o seu navegador.</p>
<p>O Zope é apenas uma das tecnologias de páginas dinâmicas que existem hoje. O ASP da Microsoft, o !ColdFusion da Macromedia e o software livre PHP são outros sistemas dinâmicos de montagem de páginas. Mas o mecanismo mais antigo, e também o mais simples de entender e de configurar, é o velho e bom CGI - ou Common Gateway Interface, um protocolo básico para interação entre um HTTPd e um programa gerador de páginas dinâmicas. É com ele que nos vamos trabalhar a partir de agora.</p>
</div>
<div class="section" id="configurando-o-seu-httpd">
<h2>Configurando o seu HTTPd<a class="headerlink" href="#configurando-o-seu-httpd" title="Link permanente para este título">¶</a></h2>
<p>Para desenvolver aplicativos CGI é importante ter um bom ambiente de testes. O ideal é ter acesso a um HTTPd só para você na fase de desenvolvimento, para maior agilidade na depuração, e não correr o risco de comprometer o funcionamento de um servidor público com bugs nos seus CGIs em construção.</p>
<p>Pode ser que o seu micro já possua um servidor HTTP. A Microsoft inclui o Personal Web Server ou o IIS em diferentes versões do Windows. Você pode tentar usar um desses HTTPd para fazer os exemplos, mas sugerimos fortemente que você vá até o <a class="reference external" href="http://www.apache.org">http://www.apache.org</a> baixe o Apache, que não custa nada (é open source), roda em qualquer plataforma Win32 ou Unix, é fácil de instalar e é tão robusto e versátil que é o HTTPd mais usado em todo mundo, alem de ser o favorito disparado entre os melhores e maiores sites da Web. Vale a pena conhecê-lo, e o download tem apenas 3 MB.</p>
<p>No Windows, o Apache vem com um instalador bem amigável. Nossa única recomendação é instalar diretamente em um diretório como c:apache e não no famoso c:Arquivos de Programas. Isso porque os espaços em nomes de diretórios às vezes causam problemas na execução de programas originários do Unix como Python e o próprio Apache.</p>
<p>Uma vez terminada a instalação, você deve rodar o servidor, acionando o programa &#8220;Start Apache&#8221; que foi instalado em Iniciar &gt; Programas &gt; Apache Web Server. Isso faz abrir uma janela DOS com uma mensagem como &#8220;Apache/1.3.9 (Win32) running...&#8221;. Não feche esta janela, pois isso encerrará a execução do servidor. Agora você pode ver se está tudo certo digitando essa URL mágica em seu browser: <a class="reference external" href="http://127.0.0.1/">http://127.0.0.1/</a>. Se a instalação foi bem sucedida, você verá uma página com o texto: &#8220;It Worked! The Apache Web Server is Installed on this Web Site!&#8221; (Funcionou! O servidor Apache está instalado neste Web Site!). (Figura 1).</p>
<img alt="_images/img_06_02.png" src="_images/img_06_02.png" />
<p>Vale a pena saber que o endereço 127.0.0.1 tem um significado especial. Os criadores da Internet reservaram esse número IP para o &#8220;loopback&#8221;, ou seja, testes de conexão de uma máquina com ela mesma. Em outras palavras, o endereço 127.0.0.1 sempre se refere à maquina onde você está, que é conhecida também pelo nome &#8220;localhost&#8221;. Se o seu micro estiver bem configurado, a URL <a class="reference external" href="http://localhost/">http://localhost/</a> deve ter o mesmo efeito. Caso contrário, utilize o número IP e vamos em frente.</p>
</div>
<div class="section" id="seu-primeiro-cgi">
<h2>Seu primeiro CGI<a class="headerlink" href="#seu-primeiro-cgi" title="Link permanente para este título">¶</a></h2>
<p>Chegamos ao grande momento. Seguindo a tradição milenar, vamos começar fazendo um CGI em Python que produz uma página com as palavras &#8220;Olá, Mundo!&#8221;. O programa completo você vê na listagem abaixo:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/python/python</span>

<span class="k">print</span> <span class="s1">&#39;Content-type: text/html&#39;</span>
<span class="k">print</span>
<span class="k">print</span> <span class="s1">&#39;&lt;HTML&gt;&lt;BODY&gt;&#39;</span>
<span class="k">print</span> <span class="s1">&#39;&lt;H1&gt;Olá, Mundo!&lt;/H1&gt;&#39;</span>
<span class="k">print</span> <span class="s1">&#39;&lt;/BODY&gt;&lt;/HTML&gt;&#39;</span>
</pre></div>
</td></tr></table></div>
<p>Antes de digitar este exemplo, é bom destacar dois aspectos essenciais. Primeiramente, o comentário da linha 1 é importante. O CGI não vai funcionar sem ele. Ao executar um script CGI, o Apache procura na primeira linha um comentário especial marcado pelos caracteres &#8216;#!&#8217;. Os sinais &#8216;#!&#8217; devem estar encostados na margem esquerda da página, e o restante dessa linha deve conter o caminho até o programa executável do interpretador que rodará o script. Note que o caminho pode ser especificado usando a barra &#8216;/&#8217; do Unix, em vez da contra-barra &#8216;&#8217; preferida pelo Windows.</p>
<p>Em meu computador, o Python está instalado em uma pasta chamada &#8220;python&#8221; localizada no mesmo drive onde está o Apache (D:, no meu caso). Se o seu Python está instalado em outro lugar, você precisará alterar a linha 1. Em caso de dificuldades, nossa sugestão é que você desinstale o interpretador e o reinstale em uma pasta &#8220;python&#8221; diretamente na raiz do mesmo disco onde você acabou de instalar o Apache.</p>
<p>Outro detalhe importante são os print das linhas 3 e 4. Sua função não é meramente decorativa. O comando print &#8216;Content-type: text/html&#8217; produz a parte obrigatória do cabeçalho da página, exigida pelo protocolo CGI. Este cabeçalho define o tipo do documento a ser transmitido de acordo com um esquema de classificação chamado &#8220;MIME&#8221;. O &#8220;text/html&#8221; é o &#8220;MIME type&#8221; padrão de documentos HTML. Um texto ASCII puro teria o MIME type &#8220;text/plain&#8221; e um arquivo de foto JPEG seria &#8220;image/jpeg&#8221;. O print da linha 4 gera uma linha em branco, que marca o fim do cabeçalho. Se uma dessas duas linhas não for digitada corretamente, o CGI não funcionará.</p>
<p>O restante da listagem apenas produz o código HTML de uma página muito simples. Os comandos marcados pelos sinais &lt; e &gt; são os chamados tags, ou marcações, da linguagem HTML. A marcação &lt;H1&gt;Manchete&lt;/H1&gt;, por exemplo, define que uma manchete de nível 1, que será exibida pelo navegador como um texto em letras grandes.</p>
</div>
<div class="section" id="instalar-e-testar-o-cgi">
<h2>Instalar e testar o CGI<a class="headerlink" href="#instalar-e-testar-o-cgi" title="Link permanente para este título">¶</a></h2>
<p>O programinha de exemplo da seção anterior deverá ser salvo com o nome <code class="docutils literal"><span class="pre">ola.py</span></code> no diretório <code class="docutils literal"><span class="pre">cgi-bin</span></code> dentro da pasta do Apache. Este diretório é criado automaticamente pelo instalador do Apache no Windows, mas deve estar vazio inicialmente. Coloque o <code class="docutils literal"><span class="pre">ola.py</span></code> ali dentro e faça o grande teste: digite <a class="reference external" href="http://">http://</a> 127.0.0.1/cgi-bin/ola.py em seu browser. Das duas, uma: ou você viu a página &#8220;Olá, Mundo!&#8221; e está feliz com seu primeiro CGI, ou ficou deprimido por encontrar uma mensagem de &#8220;Internal Server Error&#8221;. Neste caso, saiba que você está em boa companhia: todo programador de CGI já se deparou com esta mensagem. Os que dizem que nunca a viram estão mentindo. Mesmo que seu script tenha funcionado, é proveitoso entender as causas de um &#8220;Internal Server Error&#8221; para saber como depurá-lo.</p>
<p>O &#8220;Internal Server Error&#8221; ocorre quando o script CGI não gera um cabeçalho mínimo, formado por uma linha de Content-type e uma linha em branco. É o que o nosso ola.py deveria fazer nas linhas 3 e 4. Vejamos passo a passo como diagnosticar a causa do problema.</p>
<div class="section" id="a-verifique-se-o-script-pode-ser-executado-a-partir-do-prompt-do-dos">
<h3>(a) Verifique se o script pode ser executado a partir do prompt do DOS<a class="headerlink" href="#a-verifique-se-o-script-pode-ser-executado-a-partir-do-prompt-do-dos" title="Link permanente para este título">¶</a></h3>
<p>Abra uma janela do DOS e digite:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">:</span>\<span class="o">&gt;</span> <span class="n">c</span><span class="p">:</span> <span class="p">(</span><span class="n">ou</span> <span class="n">d</span><span class="p">:)</span>
</pre></div>
</div>
<p>O passo acima não é necessário se você já está no disco certo:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">:</span>\<span class="o">&gt;</span> <span class="n">cd</span> \<span class="n">apache</span>\<span class="n">cgi</span><span class="o">-</span><span class="nb">bin</span>
<span class="n">X</span><span class="p">:</span>\<span class="o">&gt;</span> <span class="n">python</span> <span class="n">ola</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Neste momento, três coisas podem acontecer:</p>
<blockquote>
<div><ol class="arabic simple">
<li>O script funciona perfeitamente, exibindo o cabeçalho, uma linha em branco, e o HTML da página - pule para o passo (b).</li>
<li>O DOS responde &#8220;Comando ou nome de arquivo inválido&#8221; - leia o passo (c).</li>
<li>O interpretador Python exibe um traceback e uma mensagem de erro qualquer - vá até o passo (d).</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="b-se-o-script-funciona-a-partir-do-prompt-mas-nao-atraves-do-apache">
<h3>(b) Se o script funciona a partir do prompt mas não através do Apache<a class="headerlink" href="#b-se-o-script-funciona-a-partir-do-prompt-mas-nao-atraves-do-apache" title="Link permanente para este título">¶</a></h3>
<p>Neste caso, existem quatro causas possíveis:</p>
<ol class="arabic simple">
<li>O comentário da linha 1 está incorreto. Lembre-se que é ele que informa ao Apache qual interpretador invocar para rodar o script. Se o seu interpretador Python (python.exe) foi instalado na pasta d:python, então a linha 1 do seu script deve ser assim: #!d:pythonpython.exe (Na verdade, a extensão .exe é dispensável, e se o Apache e o Python estão no mesmo disco, você pode usar a notação mais elegante do Unix e escrever apenas #!/python/python)</li>
<li>O script não foi colocado na pasta cgi-bin. Se o seu Apache foi instalado em c:apache, o programa ola.py tem que estar exatamente neste local: c:apachecgi-binola.py. Se este foi o problema, corrija e volte ao passo (a).</li>
<li>Apache pode não estar configurado para executar programas na pasta cgi-bin. Isso não deve acontecer em uma instalação nova do Apache, mas se você está usando um HTTPd que foi instalado por outra pessoa, ela pode ter mudado esta configuração. Neste caso, peça ajuda ao responsável pela instalação.</li>
<li>No Linux, ou em qualquer Unix, o Apache deverá ter permissão de executar o script ola.py. Para tanto, você pode precisar usar o comando chmod para setar o bit de execução de ola.py. Em Linux, o comando abaixo deve dar conta do recado:</li>
</ol>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chmod a+x ola.py
</pre></div>
</div>
<p>Se você usa outro Unix, experimente:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chmod <span class="m">755</span> ola.py
</pre></div>
</div>
<p>Uma vez marcado como executável o script poderá ser invocado diretamente pelo nome, sem necessidade de mencionar o interpretador, assim:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ./ola.py
</pre></div>
</div>
<p>Se este teste funcionou, tente acionar o script novamente pelo browser, porque um shell do Unix também utiliza o comentário #! da linha 1 para localizar o interpretador. Se isto não deu certo, volte ao item 2a acima. Se o teste funcionou mas o programa exibe um traceback, vá até o passo (d).</p>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Por fazer</p>
<p class="last">Revisar todas as referências cruzadas tipo &#8220;vá até o passo x&#8221;</p>
</div>
</div>
<div class="section" id="c-confira-a-instalacao-do-python">
<h3>(c) Confira a instalação do Python<a class="headerlink" href="#c-confira-a-instalacao-do-python" title="Link permanente para este título">¶</a></h3>
<p>Verifique se o interpretador Python (arquivo python.exe no DOS) está instalado corretamente e em local acessível. Se ele foi instalado em uma pasta chamada c:python, o seguinte comando deve acionar o seu CGI:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>X:\&gt; c:\python\python ola.py
</pre></div>
</div>
<p>O que fazer então:</p>
<ol class="arabic simple">
<li>se agora o script funcionou perfeitamente, exibindo o cabeçalho, uma linha em branco, e o HTML da página, pule para o passo (b).</li>
<li>se você continua vendo &#8220;Comando ou nome de arquivo inválido&#8221; ou outra mensagem do sistema operacional, verifique novamente o local exato da instalação do seu Python e se necessário, reinstale. Feito isso, volte para o passo (a).</li>
</ol>
</div>
<div class="section" id="d-confira-o-seu-programa">
<h3>(d) Confira o seu programa<a class="headerlink" href="#d-confira-o-seu-programa" title="Link permanente para este título">¶</a></h3>
<p>Se ao rodar o script a partir do prompt você está vendo um traceback do interpretador Python, o problema está mesmo dentro do seu programa. Quando ocorre um erro de sintaxe (<code class="docutils literal"><span class="pre">SyntaxError</span></code>) o interpretador apenas leu, mas não chegou a executar nenhuma linha do seu script. Assim, o famoso cabeçalho &#8220;Content-type: ...&#8221; e a linha em branco não são enviados para o servidor, e o traceback que o ajudaria a detectar o problema não chega ao seu browser, mas vai para um arquivo onde o Apache registra mensagens de erro. Este arquivo chama-se error.log e fica em /apache/logs/. Você pode inspecioná-lo com qualquer editor de texto. Outras vezes, o erro pode acontecer durante a execução e após o envio do cabeçalho. Neste caso, o traceback é perdido para sempre. É por isso que programadores de CGI experientes procuram testar exaustivamente seus scripts a partir da linha de comando antes de tentar acioná-lo pelo browser. Há tambem aguns truques que podem ser usados durante a depuração de um CGI para que as mensagens de erro sejam transmitidas para o browser. Em seguida veremos como.</p>
</div>
</div>
<div class="section" id="afinal-um-cgi-dinamico">
<h2>Afinal, um CGI dinâmico<a class="headerlink" href="#afinal-um-cgi-dinamico" title="Link permanente para este título">¶</a></h2>
<p>Nosso primeiro exemplo de CGI foi bolado para ser simples, mas é também um tanto tolo. Não gera nenhuma informação variável; o mesmo efeito poderia ser obtido com uma página estática. A página dinâmica mais simples que conseguimos imaginar é uma que mostre a hora certa (de acordo com o relógio do servidor). Para fazer um CGI assim, é bom conhecermos duas funções do módulo time. Vamos ver o que elas fazem acionando o interpretador Python. Primeiro, temos que importar as duas funções de dentro do módulo:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span><span class="p">,</span> <span class="n">localtime</span>
</pre></div>
</div>
<p>Podemos invocar diretamente a função time():</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="p">()</span>
<span class="go">953500536.8</span>
</pre></div>
</div>
<p>Que número é esse? Como explicamos no final do capítulo passado, o Python, assim como muitos programas originários da plataforma Unix, marca o tempo contando o número de segundos desde 1 de janeiro de 1970. Isto quer dizer que haviam se passado 953 milhões, 500 mil e 536 segundos e 8 décimos desde 1/1/1970 quando eu digitei time() no IDLE do meu computador. Isto é muito interessante, mas como transformar segundos transcorridos na hora atual? É para isso que serve a função localtime():</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">localtime</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">(2000, 3, 19, 18, 33, 19, 6, 79, 0)</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>Agora nós associamos os segundos transcorridos à variável t, e em seguida usamos a função localtime para transformar os segundos em uma seqüência de 9 números que fornecem os seguintes dados:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">localtime</span><span class="p">(</span><span class="n">t</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># 2000, 3, 19 (ano, mês e dia)</span>
<span class="n">localtime</span><span class="p">(</span><span class="n">t</span><span class="p">)[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="c1"># 18, 33, 19 (hora, minutos e segundos)</span>
<span class="n">localtime</span><span class="p">(</span><span class="n">t</span><span class="p">)[</span><span class="mi">6</span><span class="p">]</span>   <span class="c1"># 6 (dia da semana; 0 = segunda-feira; 6 = domingo)</span>
<span class="n">localtime</span><span class="p">(</span><span class="n">t</span><span class="p">)[</span><span class="mi">7</span><span class="p">]</span>   <span class="c1"># 79 (número do dia no ano; de 1 a 366 em anos bissextos)</span>
<span class="n">localtime</span><span class="p">(</span><span class="n">t</span><span class="p">)[</span><span class="mi">8</span><span class="p">]</span>   <span class="c1"># 0 (indicador de horário de verão; 0 = não; 1 = sim)</span>
</pre></div>
</td></tr></table></div>
<p>Esta função se chama localtime porque além de converter de segundos transcorridos para data e hora, ela o faz levando em conta o fuso horário configurado no sistema operacional, fornecendo portanto a hora local. Para saber a hora no meridiano de Greenwich, ou UTC no jargão moderno, usaríamos a função gmtime():</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">gmtime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="go">(2000, 3, 19, 21, 33, 19, 6, 79, 0)</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>Agora vamos combinar as novas funções para montar um CGI, hora.py, que mostre a hora local do servidor:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># hora.py - CGI que exibe a hora local do servidor</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span><span class="p">,</span> <span class="n">localtime</span>

<span class="k">print</span> <span class="s1">&#39;Content-type: text/html&#39;</span>
<span class="k">print</span>

<span class="n">h</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="p">())[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
<span class="k">print</span> <span class="s1">&#39;&lt;HTML&gt;&lt;BODY&gt;&#39;</span>
<span class="k">print</span> <span class="s1">&#39;&lt;H1&gt;Hora: </span><span class="si">%02d</span><span class="s1">:</span><span class="si">%02d</span><span class="s1">:</span><span class="si">%02d</span><span class="s1">&lt;/H1&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="k">print</span> <span class="s1">&#39;&lt;P&gt;* de acordo com o relógio interno deste servidor&lt;/P&gt;&#39;</span>
<span class="k">print</span> <span class="s1">&#39;&lt;/BODY&gt;&lt;/HTML&gt;&#39;</span>
</pre></div>
</td></tr></table></div>
<p>Uma vez salvo no diretório cgi-bin, este script poderá ser acessado pela URL <a class="reference external" href="http://">http://</a> 127.0.0.1/cgi-bin/hora.py. A página gerada conterá a hora, minutos e segundos do instante em que ela foi invocada. Qual o defeito do nosso relógio em CGI? Experimente e você verá.</p>
</div>
<div class="section" id="um-relogio-que-se-atualiza">
<h2>Um relógio que se atualiza<a class="headerlink" href="#um-relogio-que-se-atualiza" title="Link permanente para este título">¶</a></h2>
<p>É um pouco frustrante acessar uma página que mostra a hora certa, com precisão de segundos, mas fica parada no tempo (Figura 2). Para atualizar os segundos, você tem que acionar o comando de &#8220;reload&#8221; do seu browser (Exibir ¡ Atualizar ou [F5] no Internet Explorer; View ¡ Reload ou [Control][R] no Navigator). Nossa página parece um relógio quebrado, que só mostra a hora certa quanto chacoalhado.</p>
<img alt="_images/img_06_03.png" src="_images/img_06_03.png" />
<p>O ideal seria que o servidor atualizasse a página que está no seu browser a cada segundo. Infelizmente, isso é impossível. Como já dissemos, o protocolo HTTP é do tipo cliente-servidor, e isto quer dizer que a iniciativa de toda interação fica do lado do cliente. Não há como o servidor por conta própria enviar uma nova página sem que ela seja antes solicitada pelo navegador. Esta é uma limitação importante do protocolo HTTP que você precisa ter em mente ao bolar seus programas CGI.</p>
<p>Os browsers modernos suportam uma uma solução parcial para este problema. Eles reconhecem um cabeçalho especial chamado Refresh, cuja presença em um documento serve para instruir o browser a solicitar novamente a página após algum tempo. O argumento do Refresh é um número de segundos que o navegador deve esperar para pedir a atualização. Logo veremos como isso funciona na prática.</p>
<p>Para usar o Refresh basta acrescentar uma linha ao cabeçalho da resposta gerado pelo nosso CGI hora.py. A nova versão, <code class="docutils literal"><span class="pre">hora2.py</span></code> ficará assim:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/python/python</span>
<span class="c1"># hora2.py - CGI que exibe continuamente hora local do servidor</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span><span class="p">,</span> <span class="n">localtime</span>

<span class="k">print</span> <span class="s1">&#39;Content-type: text/html&#39;</span>
<span class="k">print</span> <span class="s1">&#39;Refresh: 0.6&#39;</span>
<span class="k">print</span>

<span class="n">h</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="p">())[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span>
<span class="k">print</span> <span class="s1">&#39;&lt;HTML&gt;&lt;BODY&gt;&#39;</span>
<span class="k">print</span> <span class="s1">&#39;&lt;H1&gt;Hora: </span><span class="si">%02d</span><span class="s1">:</span><span class="si">%02d</span><span class="s1">:</span><span class="si">%02d</span><span class="s1">&lt;/H1&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="k">print</span> <span class="s1">&#39;&lt;P&gt;* de acordo com o relógio interno deste servidor&lt;/P&gt;&#39;</span>
<span class="k">print</span> <span class="s1">&#39;&lt;/BODY&gt;&lt;/HTML&gt;&#39;</span>
</pre></div>
</td></tr></table></div>
<p>A única novidade é a linha 7, onde acrescentamos &#8220;Refresh: 0.6&#8221; ao cabeçalho. Em vez de mandar o browser atualizar a página a cada 1 segundo, após alguns testes decidimos fazê-lo a cada 6 décimos de segundo. Fizemos assim porque quanto experimentamos com &#8220;Refresh: 1&#8221; a contagem freqüentemente pulava um segundo, por exemplo de 10:30:20 direto para 10:30:22. Isso não quer dizer que o relógio adiantava, porque a cada nova solicitação a hora certa estava sendo consultada pelo nosso CGI; mas como o tempo de espera somado ao tempo de solicitação e resposta era maior que 1 segundo, a exibição da hora sofria alguns sobressaltos.</p>
<p>Fazendo o refresh a cada 6 décimos, muitas vezes estamos atualizando a página duas vezes no mesmo segundo, o que é um desperdício de processamento. Mas pelo menos nos livramos da enervante perturbação na contagem. É claro que se o servidor estiver sobrecarregado, ele pode levar mais de um segundo para responder. Nesse caso, de nada adiantará se o browser fizer novas solicitações a cada 0.6 segundo.</p>
</div>
<div class="section" id="calendario-dinamico">
<h2>Calendário Dinâmico<a class="headerlink" href="#calendario-dinamico" title="Link permanente para este título">¶</a></h2>
<p>Agora vamos juntar o que já sabemos sobre CGI com o módulo calendar que vimos no capítulo anterior para fazer um protótipo rápido do nosso Calendário Dinâmico. As passagens mais interessantes da listagem abaixo são comentados a seguir:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/python/python</span>
<span class="c1"># calendin.py - calendário dinâmico - protótipo 1</span>

<span class="k">print</span> <span class="s1">&#39;Content-type: text/html</span><span class="se">\n</span><span class="s1">&#39;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span><span class="p">,</span> <span class="n">localtime</span>
    <span class="kn">from</span> <span class="nn">calendar</span> <span class="kn">import</span> <span class="n">monthcalendar</span>
    <span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">join</span>

    <span class="n">ano</span><span class="p">,</span> <span class="n">mes</span> <span class="o">=</span> <span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="p">())[:</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">print</span> <span class="s1">&#39;&lt;HTML&gt;&lt;TITLE&gt;Calendário Dinâmico&lt;/TITLE&gt;&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;&lt;BODY&gt;&#39;</span>

    <span class="k">print</span> <span class="s1">&#39;&lt;H1&gt;Calendário do mês </span><span class="si">%02d</span><span class="s1">/</span><span class="si">%04d</span><span class="s1">&lt;/H1&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mes</span><span class="p">,</span> <span class="n">ano</span><span class="p">)</span>
    <span class="k">print</span> <span class="s1">&#39;&lt;PRE&gt;&#39;</span>
    <span class="k">for</span> <span class="n">semana</span> <span class="ow">in</span> <span class="n">monthcalendar</span><span class="p">(</span><span class="n">ano</span><span class="p">,</span> <span class="n">mes</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">join</span><span class="p">(</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">semana</span><span class="p">),</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="p">)</span>
    <span class="k">print</span> <span class="s1">&#39;&lt;/PRE&gt;&#39;</span>

<span class="k">except</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="kn">from</span> <span class="nn">traceback</span> <span class="kn">import</span> <span class="n">print_exc</span>
    <span class="k">print</span> <span class="s1">&#39;&lt;HR&gt;&lt;H3&gt;Erro no CGI:&lt;/H3&gt;&lt;PRE&gt;&#39;</span>
    <span class="n">print_exc</span><span class="p">()</span>
    <span class="k">print</span> <span class="s1">&#39;&lt;/PRE&gt;&#39;</span>

<span class="k">print</span> <span class="s1">&#39;&lt;/BODY&gt;&lt;/HTML&gt;&#39;</span>
</pre></div>
</td></tr></table></div>
<p>O que fizemos, linha a linha:</p>
<dl class="docutils">
<dt>Linha 4</dt>
<dd>Logo de saída produzimos o cabeçalho mínimo necessário. A linha em branco, em vez de ser gerada por um segundo comando print, está incluída no final própria string do cabeçalho (o &#8216;n&#8217; representa uma quebra de linha, e o próprio print produz outra quebra; assim obtemos a linha em branco para encerrar o cabeçalho).</dd>
<dt>Linha 6</dt>
<dd>Para facilitar a depuração, colocamos praticamente o CGI inteiro dentro de um bloco try/except. Qualquer falha na execução deste bloco será tratada a partir da linha 23. Com isso, esse script só deverá gerar um &#8220;Internal Server Error&#8221; se houver um erro de sintaxe, justamente o tipo de falha mais fácil de localizar rodando o script a partir de uma linha de comando. Desta forma a depuração fica bem mais simples.</dd>
<dt>Linhas 7 a 9</dt>
<dd>Importamos várias funções, todas velhas conhecidas.</dd>
<dt>Linha 11</dt>
<dd>Extraímos o ano e o mês do resultado de localtime(time()).</dd>
<dt>Linha 13</dt>
<dd>Iniciamos a produção do HTML, agora colocando um título na página (que aparecerá na barra de título da janela do browser).</dd>
<dt>Linhas 17 a 20</dt>
<dd>Para simplificar a formatação do calendário, colocamos seu conteúdo entre um par de tags &lt;PRE&gt;&lt;/PRE&gt;. O tag &lt;PRE&gt; faz com que o browser respeite as quebras de linha até o tag &lt;/PRE&gt;. Normalmente, o navegador ignora tabulações e quebras de linha, tratando tudo como simples espaços, mas isso estragaria nosso calendário, pois queremos mostrar uma semana por linha. O código das linhas 18 e 19 foi roubado sem alterações da listagem 3 do capítulo anterior.</dd>
<dt>Linha 22</dt>
<dd>Abrimos um bloco except para tratar qualquer erro que tenha ocorrido até aqui. Abrir um bloco except sem qualificar o tipo de exceção que será tratado é normalmente uma má idéia, porque pode mascarar muitos bugs. Nesse caso, o except &#8220;pega-tudo&#8221; está justificado porque em seguida exibiremos o traceback completo, revelando qualquer bug que tentar se esconder.</dd>
<dt>Linhas 23 e 24</dt>
<dd>Importamos o módulo sys, para podermos manipular os objetos stdout e stderr. Esses são os chamados &#8220;dispositivos lógicos&#8221; para onde toda a saída de dados do Python é direcionada. Mensagens geradas pelo comando print são enviadas para stdout, que normalmente está associado à tela do computador ou terminal. Durante a execução de um CGI, o stdout é redirecionado para o HTTPd, que vai enviar para o cliente tudo o que passar por este dispositivo. Mensagens de erro e tracebacks do Python, no entanto, vão para stderr. Se o script é invocado pela linha de comando, o stderr também está associado à tela, e assim podemos ver os tracebacks. Mas ao executar um CGI, o HTTPd simplesmente ignora o dispositivo stderr após o envio do cabeçalho, ocasionando a perda dos tracebacks. Na linha 24 associamos sys.stderr ao objeto sys.stdout. Desta maneira as mensagens de erro passam a ser enviadas para o browser através do HTTPd, como ocorre com os textos gerados por print.</dd>
<dt>Linha 25</dt>
<dd>Importamos uma função do módulo traceback para uso na linha 27.</dd>
<dt>Linha 26</dt>
<dd>Geramos tags para uma linha horizontal (&lt;HR&gt;) e o título &#8216;Erro no CGI:&#8217;; abrimos um tag &lt;PRE&gt; para manter a formatação original das linhas do traceback.</dd>
<dt>Linha 27</dt>
<dd>Usamos a função print_exc() do módulo traceback para gerar o texto de uma descrição de erro.</dd>
<dt>Linha 30</dt>
<dd>Encerramos o programa gerando os tags que marcam o fim de uma página HTML.</dd>
</dl>
</div>
<div class="section" id="prototipo-melhorado">
<h2>Protótipo melhorado<a class="headerlink" href="#prototipo-melhorado" title="Link permanente para este título">¶</a></h2>
<p>Agora que colocamos o calendário básico para funcionar, está na hora de melhorar sua apresentação. Vamos deixar de lado o recurso preguiçoso do tag &lt;PRE&gt; e colocar os dias do mês dentro de uma tabela construída em HTML (Figura 3). Aproveitando outros recursos daquela linguagem, vamos também colorir os finais de semana e assinalar o dia de hoje. Você encontra o programa <code class="docutils literal"><span class="pre">calendin2.py</span></code> na listagem abaixo.</p>
<img alt="_images/img_06_04.png" src="_images/img_06_04.png" />
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/python/python</span>
<span class="c1"># calendin2.py - calendário dinâmico - protótipo 2</span>

<span class="k">print</span> <span class="s1">&#39;Content-type: text/html</span><span class="se">\n</span><span class="s1">&#39;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span><span class="p">,</span> <span class="n">localtime</span>
    <span class="kn">from</span> <span class="nn">calendar</span> <span class="kn">import</span> <span class="n">monthcalendar</span>
    <span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">join</span>

    <span class="n">ano</span><span class="p">,</span> <span class="n">mes</span><span class="p">,</span> <span class="n">hoje</span> <span class="o">=</span> <span class="n">localtime</span><span class="p">(</span><span class="n">time</span><span class="p">())[:</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">print</span> <span class="s1">&#39;&lt;HTML&gt;&lt;TITLE&gt;Calendário Dinâmico&lt;/TITLE&gt;&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;&lt;BODY&gt;&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;&lt;CENTER&gt;&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;&lt;H1&gt;Calendário de </span><span class="si">%02d</span><span class="s1">/</span><span class="si">%04d</span><span class="s1">&lt;/H1&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mes</span><span class="p">,</span> <span class="n">ano</span><span class="p">)</span>
    <span class="k">print</span> <span class="s1">&#39;&lt;TABLE&gt;&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;&lt;TR&gt;&#39;</span>
    <span class="k">for</span> <span class="n">dia_sem</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;seg&#39;</span><span class="p">,</span><span class="s1">&#39;ter&#39;</span><span class="p">,</span><span class="s1">&#39;qua&#39;</span><span class="p">,</span><span class="s1">&#39;qui&#39;</span><span class="p">,</span><span class="s1">&#39;sex&#39;</span><span class="p">,</span><span class="s1">&#39;sab&#39;</span><span class="p">,</span><span class="s1">&#39;dom&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">dia_sem</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sab&#39;</span><span class="p">,</span><span class="s1">&#39;dom&#39;</span><span class="p">]:</span> <span class="n">bgcolor</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">bgcolor</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>
        <span class="k">print</span> <span class="s1">&#39;&lt;TH WIDTH=&quot;45&quot; BGCOLOR=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="n">bgcolor</span>
        <span class="k">print</span> <span class="s1">&#39;&lt;H3&gt;</span><span class="si">%s</span><span class="s1">&lt;/H3&gt;&lt;/TH&gt;&#39;</span> <span class="o">%</span> <span class="n">dia_sem</span>
    <span class="k">print</span> <span class="s1">&#39;&lt;/TR&gt;&#39;</span>
    <span class="k">for</span> <span class="n">semana</span> <span class="ow">in</span> <span class="n">monthcalendar</span><span class="p">(</span><span class="n">ano</span><span class="p">,</span> <span class="n">mes</span><span class="p">):</span>
        <span class="k">print</span> <span class="s1">&#39;&lt;TR&gt;&#39;</span>
        <span class="n">num_dia_sem</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">dia</span> <span class="ow">in</span> <span class="n">semana</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dia</span> <span class="o">==</span> <span class="n">hoje</span><span class="p">:</span>
                <span class="n">bgcolor</span> <span class="o">=</span> <span class="s1">&#39;pink&#39;</span>
            <span class="k">elif</span> <span class="n">num_dia_sem</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">bgcolor</span> <span class="o">=</span> <span class="s1">&#39;lightgreen&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bgcolor</span> <span class="o">=</span> <span class="s1">&#39;lightblue&#39;</span>
            <span class="k">print</span> <span class="s1">&#39;&lt;TD ALIGN=&quot;RIGHT&quot; BGCOLOR=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&#39;</span> <span class="o">%</span> <span class="n">bgcolor</span>
            <span class="k">if</span> <span class="n">dia</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;&lt;H2&gt;</span><span class="si">%2d</span><span class="s1">&lt;/H2&gt;&#39;</span> <span class="o">%</span> <span class="n">dia</span>
            <span class="k">print</span> <span class="s1">&#39;&lt;/TD&gt;&#39;</span>
            <span class="n">num_dia_sem</span> <span class="o">=</span> <span class="n">num_dia_sem</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">print</span> <span class="s1">&#39;&lt;/TR&gt;&#39;</span>
    <span class="k">print</span> <span class="s1">&#39;&lt;/TABLE&gt;&lt;/CENTER&gt;&#39;</span>

<span class="k">except</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">from</span> <span class="nn">traceback</span> <span class="kn">import</span> <span class="n">print_exc</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="k">print</span> <span class="s1">&#39;&lt;HR&gt;&lt;H3&gt;Erro no CGI:&lt;/H3&gt;&lt;PRE&gt;&#39;</span>
    <span class="n">print_exc</span><span class="p">()</span>
    <span class="k">print</span> <span class="s1">&#39;&lt;/PRE&gt;&#39;</span>

<span class="k">print</span> <span class="s1">&#39;&lt;/BODY&gt;&lt;/HTML&gt;&#39;</span>
</pre></div>
</td></tr></table></div>
<p>Principais novidades em relação à versão anterior:</p>
<dl class="docutils">
<dt>Linha 11</dt>
<dd>Além do ano e do mês, guardamos o dia de hoje, para poder assinalá-lo no calendário.</dd>
<dt>Linha 15</dt>
<dd>Vamos centralizar tudo na página.</dd>
<dt>Linha 17</dt>
<dd>Abrimos o tag &lt;TABLE&gt; que conterá o calendário propriamente dito. Esta tabela só será fechada pelo tag &lt;/TABLE&gt; na linha 41 do programa.</dd>
<dt>Linha 18</dt>
<dd>Iniciamos a primeira linha da tabela (&lt;TR&gt; = Table Row ou linha da tabela).</dd>
<dt>Linha 19</dt>
<dd>Vamos percorrer os nomes dos dias da semana para construir o cabeçalho da tabela.</dd>
<dt>Linhas 20 e 21</dt>
<dd>Sábados e domingos terão fundos verdes (green); demais dias terão fundos azuis (blue).</dd>
<dt>Linha 22</dt>
<dd>Tabelas em HTML são divididas em &#8220;células&#8221;. Há dois tags para definir células, o &lt;TH&gt; (table head = cabeça) e o &lt;TD&gt; (table data = dados). Os dias da semana ficarão dentro de células TH com largura de 45 pixels e a cor de fundo definida acima. A largura dessas células determinará a largura das colunas.</dd>
<dt>Linha 23</dt>
<dd>O nome de cada dia da semana é colocado entre tags &lt;H3&gt;&lt;/H3&gt;, para ênfase, e o tag &lt;/TH&gt; é aplicado para fechar cada célula.</dd>
<dt>Linha 24</dt>
<dd>Fechamos a primeira linha da tabela.</dd>
<dt>Linha 25</dt>
<dd>Iniciamos um loop para percorrer cada semana do mês.</dd>
<dt>Linha 26</dt>
<dd>Abrimos a linha da tabela correspondente a uma das semanas.</dd>
<dt>Linha 27</dt>
<dd>Zeramos o contador que permitirá identificar sábados e domingos (a função monthcalendar retorna semanas com início às segundas-feiras; em nossa contagem, segunda-feira será o dia zero).</dd>
<dt>Linha 28</dt>
<dd>Iniciamos outro loop, agora para percorrer cada dia da semana.</dd>
<dt>Linhas 29 a 34</dt>
<dd>A cor do fundo da próxima célula é definida assim: a célula de hoje é rosa (pink); sábados e domingos (dias 5 e 6 na semana) serão verde-claro (light green) e os demais dias serão azul-claro (light blue)</dd>
<dt>Linha 35</dt>
<dd>Abrimos a célula do dia, com a cor escolhida. Ela será fechada na linha 38.</dd>
<dt>Linhas 36 e 37</dt>
<dd>Se o número do dia é diferente de zero, colocamos o conteúdo da célula. Lembre-se que a função monthcalendar completa com zeros as semanas do primeiro e último dia do mês.</dd>
<dt>Linha 39</dt>
<dd>Incrementamos o contador de dia da semana. Aqui se encerra o bloco que percorre os dias.</dd>
<dt>Linha 40</dt>
<dd>Fechamos a linha da tabela. Fim do loop que corresponde às semanas.</dd>
</dl>
</div>
<div class="section" id="proximas-paradas">
<h2>Próximas paradas<a class="headerlink" href="#proximas-paradas" title="Link permanente para este título">¶</a></h2>
<p>Aqui termina nosso primeiro contato com programação aplicada à Web. Neste capítulo você instalou seu próprio servidor Apache, e implementou seus primeiros programas CGI. Os princípios que você está aprendendo aqui se aplicam a qualquer tecnologia de geração de páginas dinâmicas. Para construir os exemplos, lançamos mão de código HTML. Não é nosso objetivo aqui abordar esta outra linguagem, mas não podemos fazer coisas interessantes na Web sem conhecer um pouco dela. Vamos manter o uso de HTML em um nível bem elementar, e continuaremos explicando os tags mais importantes de cada exemplo, mas seu aproveitamento poderá ser melhor se você estudar por conta própria. O tutorial do Caique, que você encontra no site da [[<a class="reference external" href="http://www.magnet.com">http://www.magnet.com</a>.br|Magnet]], é mais que suficiente para acompanhar o restante deste curso.</p>
<p>No próximo número, aperfeiçoaremos nosso calendário para torná-lo interativo: em vez de mostrar sempre o mês atual, vamos permitir que o usuário escolha um mês e um ano qualquer, e também navegue para frente e para trás de mês em mês. Isso nos levará a explorar o uso de URLs com argumentos e formulários em HTML. Até lá!</p>
<p>PS. A revista MAGNET deixou de ser publicada, então este tutorial não teve continuação...</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Tabela de Conteúdo</a></h3>
  <ul>
<li><a class="reference internal" href="#">Capítulo 6: Perca o medo do servidor Apache e do protocolo CGI</a><ul>
<li><a class="reference internal" href="#paginas-dinamicas">Páginas dinâmicas</a></li>
<li><a class="reference internal" href="#configurando-o-seu-httpd">Configurando o seu HTTPd</a></li>
<li><a class="reference internal" href="#seu-primeiro-cgi">Seu primeiro CGI</a></li>
<li><a class="reference internal" href="#instalar-e-testar-o-cgi">Instalar e testar o CGI</a><ul>
<li><a class="reference internal" href="#a-verifique-se-o-script-pode-ser-executado-a-partir-do-prompt-do-dos">(a) Verifique se o script pode ser executado a partir do prompt do DOS</a></li>
<li><a class="reference internal" href="#b-se-o-script-funciona-a-partir-do-prompt-mas-nao-atraves-do-apache">(b) Se o script funciona a partir do prompt mas não através do Apache</a></li>
<li><a class="reference internal" href="#c-confira-a-instalacao-do-python">(c) Confira a instalação do Python</a></li>
<li><a class="reference internal" href="#d-confira-o-seu-programa">(d) Confira o seu programa</a></li>
</ul>
</li>
<li><a class="reference internal" href="#afinal-um-cgi-dinamico">Afinal, um CGI dinâmico</a></li>
<li><a class="reference internal" href="#um-relogio-que-se-atualiza">Um relógio que se atualiza</a></li>
<li><a class="reference internal" href="#calendario-dinamico">Calendário Dinâmico</a></li>
<li><a class="reference internal" href="#prototipo-melhorado">Protótipo melhorado</a></li>
<li><a class="reference internal" href="#proximas-paradas">Próximas paradas</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="cap5.html" title="capítulo anterior">Capítulo 5: O segredo dos objetos-função</a></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>Essa Página</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/cap6.rst.txt"
            rel="nofollow">Exibir Fonte</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Busca rápida</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Ir" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Luciano Ramalho.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/cap6.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>